# Railway Deployment Guide

## Prerequisites
- GitHub account
- Railway account (sign up at railway.app)
- Backend code pushed to GitHub repository

## Step 1: Create Railway Project

1. Go to https://railway.app
2. Click "Start a New Project"
3. Select "Deploy from GitHub repo"
4. Authorize Railway to access your GitHub
5. Select your repository: `Browser_Based_Todo_App`

## Step 2: Add PostgreSQL Database

1. In your Railway project dashboard, click "New"
2. Select "Database" → "Add PostgreSQL"
3. Railway will automatically provision a PostgreSQL database
4. The `DATABASE_URL` environment variable is automatically created

## Step 3: Configure Backend Service

1. Click on your backend service in Railway dashboard
2. Go to "Settings" tab
3. Set "Root Directory" to: `backend`
4. Set "Start Command" (if not auto-detected): `uvicorn src.main:app --host 0.0.0.0 --port $PORT`

## Step 4: Add Environment Variables

In your backend service, go to "Variables" tab and add:

```
ENVIRONMENT=production
FRONTEND_URL=https://your-vercel-app.vercel.app
JWT_SECRET_KEY=<generate-secure-random-string>
BACKEND_CORS_ORIGINS=https://your-vercel-app.vercel.app
```

**Note:** `DATABASE_URL` is automatically provided by Railway PostgreSQL plugin.

### Generate JWT Secret Key

Run this command locally to generate a secure key:
```bash
python -c "import secrets; print(secrets.token_urlsafe(32))"
```

## Step 5: Deploy

1. Railway will automatically deploy when you push to your main branch
2. Wait for deployment to complete (check logs in Railway dashboard)
3. Once deployed, Railway will provide a public URL like: `https://your-app.up.railway.app`

## Step 6: Run Database Migrations

1. In Railway dashboard, click on your backend service
2. Go to "Settings" → "Deploy"
3. Add a "Deploy Command" (optional):
   ```
   alembic upgrade head
   ```
   Or run manually in Railway CLI:
   ```bash
   railway run alembic upgrade head
   ```

## Step 7: Get Your Backend URL

1. In Railway dashboard, click on your backend service
2. Go to "Settings" tab
3. Under "Networking", click "Generate Domain"
4. Copy the generated URL (e.g., `https://your-app.up.railway.app`)
5. Use this URL in your frontend `.env.production`:
   ```
   NEXT_PUBLIC_API_URL=https://your-app.up.railway.app
   ```

## Step 8: Update Frontend CORS

1. Go back to Railway dashboard
2. Update the `FRONTEND_URL` variable with your actual Vercel URL
3. Redeploy if needed

## Verify Deployment

1. Visit your Railway backend URL: `https://your-app.up.railway.app`
2. You should see: `{"message": "Welcome to the Todo Application API", "status": "healthy"}`
3. Check API docs: `https://your-app.up.railway.app/docs`

## Troubleshooting

### Database Connection Issues
- Verify `DATABASE_URL` is set correctly
- Check PostgreSQL plugin is running
- Review logs in Railway dashboard

### CORS Errors
- Ensure `FRONTEND_URL` matches your Vercel deployment URL exactly
- Include protocol (https://)
- No trailing slash

### Build Failures
- Check `requirements.txt` is in backend directory
- Verify Python version compatibility
- Review build logs in Railway dashboard

### Port Issues
- Railway automatically sets `$PORT` environment variable
- Ensure Procfile uses `--port $PORT`

## Continuous Deployment

Railway automatically deploys when you push to your connected branch:

```bash
git add .
git commit -m "Update backend"
git push origin main
```

## Monitoring

- View logs: Railway Dashboard → Service → Logs
- Check metrics: Railway Dashboard → Service → Metrics
- Database usage: Railway Dashboard → PostgreSQL → Metrics

## Cost

- Railway offers a free tier with limited resources
- PostgreSQL database included in free tier
- Monitor usage in Railway dashboard

## Environment Variables Reference

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| DATABASE_URL | Yes (auto) | PostgreSQL connection string | Auto-generated by Railway |
| ENVIRONMENT | Yes | Deployment environment | production |
| FRONTEND_URL | Yes | Vercel frontend URL | https://app.vercel.app |
| JWT_SECRET_KEY | Yes | Secret key for JWT tokens | Random secure string |
| BACKEND_CORS_ORIGINS | Optional | Additional CORS origins | https://app.vercel.app |

## Security Checklist

- ✅ PostgreSQL database with Railway (not SQLite)
- ✅ Strong JWT secret key
- ✅ CORS restricted to specific domains
- ✅ HTTPS enabled (automatic with Railway)
- ✅ Environment variables secured
- ✅ Password hashing with bcrypt
- ✅ Password strength validation

## Next Steps

1. Deploy frontend to Vercel (see VERCEL_DEPLOYMENT.md)
2. Update frontend with Railway backend URL
3. Test registration and login flows
4. Monitor logs and performance
